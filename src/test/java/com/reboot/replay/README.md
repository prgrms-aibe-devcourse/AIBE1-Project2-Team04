# í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ë” ê²¬ê³ í•œ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°: Replay ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ë“¤ì–´ê°€ë©°

ì•ˆë…•í•˜ì„¸ìš”, ê°œë°œì ì—¬ëŸ¬ë¶„! ì´ ë¬¸ì„œëŠ” Replay ëª¨ë“ˆì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ë‹¨ìˆœíˆ ì½”ë“œ í’ˆì§ˆì„ ê²€ì¦í•˜ëŠ” ê²ƒì„ ë„˜ì–´, ê°œë°œ ì†ë„ë¥¼ ë†’ì´ê³  ë¦¬íŒ©í† ë§ì„ ìì‹ ìˆê²Œ í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ë“ ë“ í•œ ì•ˆì „ë§ì…ë‹ˆë‹¤. ì´ ê°€ì´ë“œë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ì˜ ì¦ê±°ì›€ì„ ê²½í—˜í•´ë³´ì„¸ìš”!

## í…ŒìŠ¤íŠ¸ì˜ ì¥ì 

ğŸš€ **ë¹ ë¥¸ ê°œë°œ ì†ë„** - ë‹¤ë¥¸ ëª¨ë“ˆì— ì˜ì¡´í•˜ì§€ ì•Šê³  ë…ë¦½ì ìœ¼ë¡œ Replay ëª¨ë“ˆë§Œ ê°œë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ğŸ›¡ï¸ **ì•ˆì „í•œ ë¦¬íŒ©í† ë§** - ì½”ë“œ ë³€ê²½ í›„ì—ë„ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ë©´ ê¸°ëŠ¥ì´ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•œë‹¤ëŠ” í™•ì‹ ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ğŸ” **ë²„ê·¸ ì¡°ê¸° ë°œê²¬** - í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬í•˜ê¸° ì „ì— ë¬¸ì œë¥¼ ë¯¸ë¦¬ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ğŸ“š **ì‚´ì•„ìˆëŠ” ë¬¸ì„œ** - í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ëª¨ë“ˆì˜ ë™ì‘ ë°©ì‹ì„ ì„¤ëª…í•˜ëŠ” ì¢‹ì€ ì˜ˆì œê°€ ë©ë‹ˆë‹¤.  
ğŸ˜Œ **ìŠ¤íŠ¸ë ˆìŠ¤ ê°ì†Œ** - "ì´ ì½”ë“œê°€ ì œëŒ€ë¡œ ë™ì‘í• ê¹Œ?" í•˜ëŠ” ë¶ˆì•ˆê°ì—ì„œ ë²—ì–´ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## í…ŒìŠ¤íŠ¸ êµ¬ì„±

ìš°ë¦¬ì˜ í…ŒìŠ¤íŠ¸ í™˜ê²½ì€ ì„¸ ê°€ì§€ ì£¼ìš” ê³„ì¸µìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

### 1. ReplayTestConfig

ëª¨ë“  ë§ˆë²•ì€ ì—¬ê¸°ì„œ ì‹œì‘ë©ë‹ˆë‹¤! ì´ ì„¤ì • í´ë˜ìŠ¤ëŠ” í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ëª¨ë“  ì˜ì¡´ì„±ì„ ëª¨í‚¹(ê°€ì§œë¡œ ë§Œë“¤ê¸°)í•˜ì—¬ Replay ëª¨ë“ˆì„ ì™„ì „íˆ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

```java
@Configuration
@Profile("test")
public class ReplayTestConfig {
    
    @Bean
    @Primary
    public ReplayRepository replayRepository() {
        return Mockito.mock(ReplayRepository.class);
    }
    
    @Bean
    @Primary
    public ReservationRepository reservationRepository() {
        return Mockito.mock(ReservationRepository.class);
    }
    
    // ê¸°íƒ€ í•„ìš”í•œ ì˜ì¡´ì„±ë“¤...
    
    @Bean
    public ReplayService replayService() {
        return new ReplayServiceImpl(
            replayRepository(), 
            reservationRepository()
            // ê¸°íƒ€ í•„ìš”í•œ ì˜ì¡´ì„±ë“¤...
        );
    }
}
```

### 2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

ê°œë³„ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ ê²€ì¦í•©ë‹ˆë‹¤:

- `ReplayServiceTest.java`: YouTube URL ê²€ì¦, ì˜ìƒ ì •ë³´ ì²˜ë¦¬ ë“± ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸
- `ReplayControllerTest.java`: ë¦¬í”Œë ˆì´ ì—…ë¡œë“œ, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ ë“± HTTP ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

### 3. í†µí•© í…ŒìŠ¤íŠ¸

- `ReplayModuleTest.java`: ëª¨ë“ˆ ë‚´ ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ìƒí˜¸ì‘ìš© í…ŒìŠ¤íŠ¸

## í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•

í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì€ ì •ë§ ê°„ë‹¨í•©ë‹ˆë‹¤! ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”:

```bash
# ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
./gradlew test --tests "com.reboot.replay.service.ReplayServiceTest"

# ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
./gradlew test --tests "com.reboot.replay.controller.ReplayControllerTest"

# ëª¨ë“ˆ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./gradlew test --tests "com.reboot.replay.ReplayModuleTest"

# ëª¨ë“  Replay ê´€ë ¨ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./gradlew test --tests "com.reboot.replay.*"
```

## í…ŒìŠ¤íŠ¸ ì‘ì„± ì‹¤ì „ íŒ

### 1. BDD ìŠ¤íƒ€ì¼ì˜ í…ŒìŠ¤íŠ¸ ì‘ì„±

BDD(Behavior-Driven Development) ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ ë” ì½ê¸° ì‰½ê³  ì˜ë„ê°€ ëª…í™•í•´ì§‘ë‹ˆë‹¤:

```java
@Test
@DisplayName("ìœ íŠœë¸Œ URLì´ ì˜¬ë°”ë¥´ê²Œ ë³€í™˜ë˜ì–´ì•¼ í•œë‹¤")
void youtubeUrlConversion() {
    // Given (ì¤€ë¹„): í…ŒìŠ¤íŠ¸í•  ìœ íŠœë¸Œ URL ì¤€ë¹„
    String youtubeUrl = "https://www.youtube.com/watch?v=abc123";
    
    // ë¹„ë””ì˜¤ ID ì¶”ì¶œê³¼ ì„ë² ë“œ URL ìƒì„±ì„ ìœ„í•œ ì‘ë‹µ DTO ìƒì„±
    ReplayResponse response = ReplayResponse.builder()
            .fileUrl(youtubeUrl)
            .build();
    
    // When (ì‹¤í–‰): ë©”ì„œë“œ ì‹¤í–‰
    String videoId = response.getYoutubeVideoId();
    String embedUrl = response.getYoutubeEmbedUrl();
    
    // Then (ê²€ì¦): ê²°ê³¼ í™•ì¸
    assertEquals("abc123", videoId);
    assertEquals("https://www.youtube.com/embed/abc123", embedUrl);
}
```

### 2. í…ŒìŠ¤íŠ¸ ë°ì´í„° íŒ©í† ë¦¬ ì‚¬ìš©

í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±ì„ ìœ„í•œ íŒ©í† ë¦¬ ë©”ì„œë“œë¥¼ ë§Œë“¤ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ê°„ê²°í•´ì§‘ë‹ˆë‹¤:

```java
private Replay createTestReplay(Long id, String youtubeUrl) {
    Reservation reservation = new Reservation();
    reservation.setReservationId(1L);
    
    return Replay.builder()
            .replayId(id)
            .reservation(reservation)
            .fileUrl(youtubeUrl)
            .date(LocalDateTime.now())
            .build();
}
```

### 3. í…ŒìŠ¤íŠ¸ ê°€ë…ì„± ë†’ì´ê¸°

`@DisplayName`ê³¼ ì£¼ì„ì„ í™œìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ì˜ ì˜ë„ë¥¼ ëª…í™•í•˜ê²Œ í‘œí˜„í•˜ì„¸ìš”:

```java
@Test
@DisplayName("ìœ íš¨í•˜ì§€ ì•Šì€ YouTube URLë¡œ ë¦¬í”Œë ˆì´ ì €ì¥ ì‹œ ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤")
void saveReplayWithInvalidUrl() {
    // ìœ íš¨í•˜ì§€ ì•Šì€ URLì„ ê°€ì§„ ìš”ì²­ ê°ì²´
    ReplayRequest invalidRequest = ReplayRequest.builder()
            .reservationId(1L)
            .fileUrl("https://www.invalid-url.com")
            .build();
    
    // ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸
    assertThrows(IllegalArgumentException.class, 
        () -> replayService.saveReplay(invalidRequest));
    
    // ë¦¬í¬ì§€í† ë¦¬ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
    verify(replayRepository, never()).save(any(Replay.class));
}
```

## í…ŒìŠ¤íŠ¸ ì‹œ ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œ í•´ê²°

### 1. ëª¨ì˜ ê°ì²´(Mock) ë™ì‘ ë¬¸ì œ

**ë¬¸ì œ**: ëª¨ì˜ ê°ì²´ê°€ ì˜ˆìƒëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
**í•´ê²°**: `verify()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ì˜ ê°ì²´ì˜ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:

```java
// ë¦¬í”Œë ˆì´ ì €ì¥ ë©”ì„œë“œê°€ ì •í™•íˆ 1ë²ˆ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸
verify(replayRepository, times(1)).save(any(Replay.class));

// ë¦¬í”Œë ˆì´ ì‚­ì œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
verify(replayRepository, never()).delete(any(Replay.class));
```

### 2. í…ŒìŠ¤íŠ¸ ê°„ ê°„ì„­ ë¬¸ì œ

**ë¬¸ì œ**: í…ŒìŠ¤íŠ¸ ê°„ì— ìƒíƒœê°€ ê³µìœ ë˜ì–´ ê°„ì„­ì´ ë°œìƒí•©ë‹ˆë‹¤.  
**í•´ê²°**: ê° í…ŒìŠ¤íŠ¸ ë©”ì„œë“œ ì „ì— `@BeforeEach`ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ì˜ ê°ì²´ë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”:

```java
@BeforeEach
void setUp() {
    // ëª¨ë“  ëª¨ì˜ ê°ì²´ ì´ˆê¸°í™”
    reset(replayRepository, reservationRepository);
    
    // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„¤ì •
    testReservation = new Reservation();
    testReservation.setReservationId(1L);
    
    testReplay = createTestReplay(1L, "https://www.youtube.com/watch?v=abc123");
}
```

### 3. YouTube URL ê²€ì¦ ê´€ë ¨ ë¬¸ì œ

**ë¬¸ì œ**: YouTube URL í˜•ì‹ì´ ë‹¤ì–‘í•˜ì—¬ ì²˜ë¦¬ê°€ ì–´ë µìŠµë‹ˆë‹¤.  
**í•´ê²°**: ë‹¤ì–‘í•œ URL í˜•ì‹ì„ í…ŒìŠ¤íŠ¸í•˜ì—¬ ëª¨ë“  ì¼€ì´ìŠ¤ë¥¼ ì»¤ë²„í•˜ì„¸ìš”:

```java
@Test
@DisplayName("ë‹¤ì–‘í•œ YouTube URL í˜•ì‹ì—ì„œ ì˜ìƒ IDê°€ ì˜¬ë°”ë¥´ê²Œ ì¶”ì¶œë˜ì–´ì•¼ í•œë‹¤")
void extractVideoIdFromVariousFormats() {
    // í‘œì¤€ URL
    ReplayResponse response1 = ReplayResponse.builder()
            .fileUrl("https://www.youtube.com/watch?v=abc123")
            .build();
    
    // ë‹¨ì¶• URL
    ReplayResponse response2 = ReplayResponse.builder()
            .fileUrl("https://youtu.be/def456")
            .build();
    
    // ë§¤ê°œë³€ìˆ˜ê°€ ìˆëŠ” URL
    ReplayResponse response3 = ReplayResponse.builder()
            .fileUrl("https://www.youtube.com/watch?v=ghi789&feature=share")
            .build();
    
    assertEquals("abc123", response1.getYoutubeVideoId());
    assertEquals("def456", response2.getYoutubeVideoId());
    assertEquals("ghi789", response3.getYoutubeVideoId());
}
```

## ë§ˆë¬´ë¦¬

í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ë‹¨ìˆœí•œ ì½”ë“œ ê²€ì¦ ë„êµ¬ê°€ ì•„ë‹ˆë¼, ë” ë‚˜ì€ ì„¤ê³„ë¥¼ ì´ëŒì–´ë‚´ëŠ” ë„êµ¬ì´ê¸°ë„ í•©ë‹ˆë‹¤. "í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ìš´ ì½”ë“œëŠ” ì„¤ê³„ê°€ ì˜ëª»ëœ ì½”ë“œì¼ ìˆ˜ ìˆë‹¤"ëŠ” ë§ì´ ìˆë“¯ì´, í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë©´ì„œ ì½”ë“œì˜ í’ˆì§ˆì„ ë†’ì—¬ë³´ì„¸ìš”.

Replay ëª¨ë“ˆì˜ í…ŒìŠ¤íŠ¸ëŠ” íŠ¹íˆ YouTube URL ì²˜ë¦¬ì™€ ê´€ë ¨ëœ ë¡œì§ì„ ê²€ì¦í•˜ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤. ë‹¤ì–‘í•œ URL í˜•ì‹ì„ í…ŒìŠ¤íŠ¸í•˜ê³ , ì„ë² ë“œ URL ìƒì„± ê¸°ëŠ¥ì´ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

ì´ ê°€ì´ë“œê°€ ì—¬ëŸ¬ë¶„ì˜ í…ŒìŠ¤íŠ¸ ì—¬ì •ì— ë„ì›€ì´ ë˜ê¸¸ ë°”ëë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ì™€ í•¨ê»˜ë¼ë©´, ë” ìì‹ ê° ìˆê²Œ ì½”ë“œë¥¼ ë³€ê²½í•˜ê³ , ë” ë¹ ë¥´ê²Œ ê°œë°œí•˜ë©°, ë” ì•ˆì •ì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

í–‰ë³µí•œ í…ŒìŠ¤íŒ… ë˜ì„¸ìš”! ğŸ¯âœ¨