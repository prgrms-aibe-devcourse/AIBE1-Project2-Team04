<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>강의 예약</title>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background: #fafbfc; margin: 0; }
        .container { display: flex; max-width: 1000px; margin: 40px auto; gap: 32px; }
        .lecture-info { flex: 2; background: #fff; padding: 32px; border-radius: 12px; box-shadow: 0 2px 8px #0001; }
        .reservation-card { flex: 1; background: #fff; padding: 32px; border-radius: 12px; box-shadow: 0 2px 8px #0001; }
        .lecture-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 12px; }
        .lecture-desc { color: #444; margin-bottom: 24px; }
        .price { font-size: 1.2rem; color: #2e7dff; font-weight: bold; }
        .form-label { display: block; margin: 16px 0 8px; font-weight: 500; }
        .form-input, .form-textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
        .form-textarea { resize: vertical; min-height: 60px; }
        .form-btn { width: 100%; margin-top: 24px; padding: 12px 0; background: #2e7dff; color: #fff; border: none; border-radius: 6px; font-size: 1.1rem; cursor: pointer; }
        .form-btn:hover { background: #185bb5; }
        .calendar-input { background: #f7f9fa; }
        .replay-link { display: inline-block; margin: 12px 0; color: #2e7dff; text-decoration: underline; }
        .section-divider { border-top: 1px solid #eee; margin: 24px 0 16px; padding-top: 8px; }
        .replay-toggle { color: #2e7dff; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; user-select: none; }
        .replay-toggle:hover { text-decoration: underline; }
        .replay-fields { max-height: 0; overflow: hidden; transition: max-height 0.3s; }
        .replay-fields.show { max-height: 200px; }
        .replay-note { font-size: 0.85rem; color: #666; margin-top: 8px; }
    </style>
    <!-- 캘린더용 jQuery UI -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script>
        $(function() {
            $("#scheduleDate").datepicker({
                dateFormat: "yy-mm-dd",
                minDate: 0
            });

            // 리플레이 토글 기능
            $("#replay-toggle").click(function() {
                $("#replay-fields").toggleClass("show");
                var isExpanded = $("#replay-fields").hasClass("show");
                $(this).html(isExpanded ? '리플레이 등록 <span style="margin-left:4px;">▲</span>' : '리플레이 등록 <span style="margin-left:4px;">▼</span>');

                // 토글 상태에 따라 필드 활성화/비활성화
                if(isExpanded) {
                    $("#youtubeUrl").prop("disabled", false);
                } else {
                    $("#youtubeUrl").prop("disabled", true);
                }
            });
        });
    </script>
</head>
<body>
<div class="container">
    <!-- 좌측: 강의 정보 -->
    <div class="lecture-info">
        <div class="lecture-title" th:text="${lecture.title}"></div>
        <div class="lecture-desc" th:text="${lecture.description}"></div>
        <div class="price">
            <span th:text="${#numbers.formatInteger(lecture.price, 0, 'COMMA')}"></span>원
        </div>
        <!-- 필요시 추가 정보, 안내 등 -->
    </div>
    <!-- 우측: 예약 카드 -->
    <div class="reservation-card">
        <form th:action="@{/reservation}" th:object="${reservationRequestDto}" method="post">
            <input type="hidden" th:field="*{memberId}" />
            <input type="hidden" th:field="*{lectureId}" />
            <input type="hidden" th:field="*{instructorId}" />

            <label class="form-label">요청사항</label>
            <textarea th:field="*{requestDetail}" class="form-textarea" placeholder="요청사항을 입력하세요"></textarea>

            <label class="form-label">강의 일정 선택</label>
            <input type="text" id="scheduleDate" th:field="*{scheduleDate}" class="form-input calendar-input" readonly placeholder="날짜를 선택하세요"/>

            <!-- 리플레이 섹션 -->
            <div class="section-divider"></div>
            <div class="replay-toggle" id="replay-toggle">리플레이 등록 <span style="margin-left:4px;">▼</span></div>

            <div id="replay-fields" class="replay-fields">
                <label class="form-label">YouTube URL</label>
                <input type="text" id="youtubeUrl" name="youtubeUrl" class="form-input" placeholder="YouTube 영상 URL을 입력하세요" disabled>
                <div class="replay-note">YouTube 영상 URL을 입력하시면 이 예약과 연결된 리플레이가 생성됩니다.</div>
            </div>

            <a th:href="@{/replay/list}" target="_blank" class="replay-link">리플레이 목록 보기</a>

            <button type="submit" class="form-btn">예약완료</button>
        </form>
    </div>
</div>
</body>
</html>