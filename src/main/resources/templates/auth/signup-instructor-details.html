<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>강사 추가 정보 입력 - 게임 코칭 매칭 플랫폼</title>

    <!--헤드 포함-->
    <th:block th:replace="fragments/config :: configFragment"></th:block>

</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- 헤더 포함 -->
<div th:replace="fragments/header :: header"></div>
  
<!-- 메인 콘텐츠 -->
<div class="flex-grow flex items-center justify-center py-8 px-4 sm:px-6 lg:px-8">
    <div class="w-full max-w-md">
        <!-- 타이틀 -->
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold text-gray-900">강사 회원 가입 완료</h2>
            <p class="text-gray-600 mt-2">강사 활동을 위한 추가 정보를 입력해주세요.</p>
            <p class="text-gray-600 mt-2">마이페이지에서 해당 내용은 수정가능합니다.</p>
        </div>

        <!-- 오류 메시지 표시 (필요시) -->
        <div th:if="${error}" class="mb-4 p-4 bg-red-100 border border-red-300 text-red-700 rounded">
            <p th:text="${error}"></p>
        </div>

        <!-- 강사 추가 정보 입력 폼 -->
        <div class="bg-white shadow-sm rounded-lg p-8 mb-6">
            <form th:action="@{/auth/sign_details}" method="post" class="space-y-5" enctype="multipart/form-data">
                <!-- Hidden input for user ID or some identifier from previous step if needed -->
                <!-- <input type="hidden" name="userId" th:value="${userId}" /> -->

            <!-- 프로필 이미지 미구현으로 주석
                <div>
                    <label for="profileImage" class="block text-sm font-medium text-gray-700 mb-1">프로필 이미지</label>
                    <div class="mt-1 flex items-center space-x-3">
                <span
                        class="inline-block h-16 w-16 rounded-full overflow-hidden bg-gray-100"
                        id="profileImagePreviewContainer"
                >
                  <img
                          id="profileImagePreview"
                          src="#"
                          alt="Profile Preview"
                          class="h-full w-full object-cover hidden"
                  />
                  <svg
                          id="profileImagePlaceholder"
                          class="h-full w-full text-gray-300"
                          fill="currentColor"
                          viewBox="0 0 24 24"
                  >
                    <path
                            d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"
                    />
                  </svg>
                </span>
                        <input
                                type="file"
                                id="profileImage"
                                name="profileImage"
                                accept="image/*"
                                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary/90"
                        />
                    </div>
                    <p class="mt-1 text-xs text-gray-500">PNG, JPG, GIF 파일을 최대 5MB까지 업로드할 수 있습니다.</p>
                </div>
                -->

                <div>
                    <label for="game" class="block text-sm font-medium text-gray-700 mb-1">게임 선택</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                            <i class="ri-gamepad-line"></i>
                        </div>
                        <select
                                id="game"
                                name="game"
                                required
                                class="pl-10 pr-3 py-3 w-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none"
                        >
                            <option value="">게임을 선택하세요</option>
                            <option value="lol">리그 오브 레전드</option>
                            <option value="valorant">발로란트</option>
                            <option value="tft">전략적팀전투</option>
                            <!-- 다른 게임 옵션 추가 -->
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400">
                            <i class="ri-arrow-down-s-line"></i>
                        </div>
                    </div>
                </div>

                <div>
                    <label for="rank" class="block text-sm font-medium text-gray-700 mb-1">게임 랭크</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                            <i class="ri-medal-line"></i>
                        </div>
                        <select
                                id="rank"
                                name="rank"
                                required
                                class="pl-10 pr-3 py-3 w-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none"
                        >
                            <option value="">랭크를 선택하세요</option>
                            <!--<option value="bronze">브론즈</option>-->
                            <!--<option value="silver">실버</option>-->
                            <!--<option value="gold">골드</option>-->
                            <!-- 다른 랭크 옵션 추가 -->
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400">
                            <i class="ri-arrow-down-s-line"></i>
                        </div>
                    </div>
                </div>

                <div id="position_container">
                    <label for="position" class="block text-sm font-medium text-gray-700 mb-1">게임 포지션</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                            <i class="ri-team-line"></i>
                        </div>
                        <select
                                id="position"
                                name="position"
                                required
                                class="pl-10 pr-3 py-3 w-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none"
                        >
                            <option value="">포지션을 선택하세요</option>
                            <!--<option value="top">탑</option>-->
                            <!--<option value="jungle">정글</option>-->
                            <!--<option value="mid">미드</option>-->
                            <!-- 다른 포지션 옵션 추가 -->
                        </select>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400">
                            <i class="ri-arrow-down-s-line"></i>
                        </div>
                    </div>
                </div>

                <div>
                    <label for="career" class="block text-sm font-medium text-gray-700 mb-1">경력</label>
                    <textarea
                            id="career"
                            name="career"
                            rows="3"
                            class="p-3 w-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                            placeholder="경력을 입력하세요 (예: 프로게이머 경력 2년, 코칭 경력 3년)"
                    ></textarea>
                </div>

                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">소개글</label>
                    <textarea
                            id="description"
                            name="description"
                            rows="4"
                            class="p-3 w-full border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                            placeholder="자신을 소개하는 글을 작성해주세요."
                    ></textarea>
                </div>

                <div>
                    <button
                            type="submit"
                            class="w-full flex justify-center py-3 px-4 border border-transparent !rounded-button shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary whitespace-nowrap"
                    >
                        정보 저장 및 완료
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 푸터 포함 -->
<div th:replace="fragments/footer :: footer"></div>

<!-- 공통 스크립트 포함 -->
<div th:replace="fragments/scripts :: scripts"></div>
</body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const profileImageInput = document.getElementById('profileImage');
        const profileImagePreview = document.getElementById('profileImagePreview');
        const profileImagePlaceholder = document.getElementById('profileImagePlaceholder');

        if (profileImageInput) {
            profileImageInput.addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        profileImagePreview.src = e.target.result;
                        profileImagePreview.classList.remove('hidden');
                        profileImagePlaceholder.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    profileImagePreview.src = '#';
                    profileImagePreview.classList.add('hidden');
                    profileImagePlaceholder.classList.remove('hidden');
                }
            });
        }

        Select_Rank_Items();
        Select_Position_Items();

        const urlParams = new URL(location.href).searchParams;

        // 상세 정보 폼 제출
        const registerForm = document.querySelector('form');
        registerForm.addEventListener('submit', async function (e) {
            e.preventDefault();

            const signupData = {
                username: urlParams.get('username'),
                career: document.getElementById('career').value,
                description: document.getElementById('description').value,
                // profileImage: document.getElementById('profileImagePreview').value,
                gameType: document.getElementById('game').value,
                gameTier: document.getElementById('rank').value,
                gamePosition: document.getElementById('position').value,
            };

            console.log(signupData);

            const response = await fetch('/auth/sign_details', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(signupData),
            });

            const result = await response.json();

            if (result.success) {
                window.location.href = '/auth/login';
            } else {
                errorDiv.style.display = 'block';
                errorMsg.textContent = result.message;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    });

    function Select_Rank_Items() {
        const tierData = {
            lol: ['챌린저', '그랜드마스터', '마스터', '다이아몬드'],
            valorant: ['레디언트', '불멸', '초월자', '다이아몬드'],
            tft: ['챌린저', '그랜드마스터', '마스터', '다이아몬드'],
        };

        const gameSelect = document.querySelector('#game');
        const tierSelect = document.querySelector('#rank');

        gameSelect.addEventListener('change', function () {
            const selectedGame = this.value;

            tierSelect.innerHTML = '';

            if (selectedGame && tierData[selectedGame]) {
                tierData[selectedGame].forEach((tier) => {
                    const option = document.createElement('option');
                    option.value = tier;
                    option.textContent = tier;
                    tierSelect.appendChild(option);
                });
            } else {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = '-- 먼저 게임을 선택하세요 --';
                tierSelect.appendChild(option);
            }
        });
    }

    function Select_Position_Items() {
        const positionData = {
            lol: ['탑', '미드', '정글', '원딜', '서포터'],
            valorant: ['감시자', '전략가', '척후대', '타격대'],
        };

        const gameSelect = document.querySelector('#game');
        const position_container = document.querySelector('#position_container');
        const positionSelect = document.querySelector('#position');

        gameSelect.addEventListener('change', function () {
            const selectedGame = this.value;

            positionSelect.innerHTML = '';

            if (selectedGame && positionData[selectedGame]) {
                position_container.style.display = 'block';

                positionData[selectedGame].forEach((position) => {
                    const option = document.createElement('option');
                    option.value = position;
                    option.textContent = position;
                    positionSelect.appendChild(option);
                });
            } else {
                position_container.style.display = 'none';
            }
        });
    }
</script>
</body>
</html>